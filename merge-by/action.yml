name: "Merge-by"
description: "Tracks the status of ongoing pull requests and provides expected dates for merging"

inputs:
  operation:
    description: 'The operation to run as part of this action (table, bump-dates)'
    required: true
    default: 'build-table'

runs:
  using: "composite"
  steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Install pnpm
      uses: pnpm/action-setup@v4
      with:
        version: 8
        run_install: false

    - name: Install Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 20
        cache: 'pnpm'

    - run: pnpm install
      shell: "sh"

    - uses: actions/github-script@v7
      if: ${{ inputs.operation == 'build-table' }}
      with:
        script: |
            const script = require("${{ github.action_path }}/scripts/build-table-and-notify.js");
            await script({ github, context });

    - uses: actions/github-script@v7
      if: ${{ inputs.operation == 'bump-dates' }}
      with:
        script: |
            const script = require("${{ github.action_path }}/scripts/bump-dates.js");
            await script({ github, context });

          